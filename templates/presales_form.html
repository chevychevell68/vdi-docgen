{% extends "base.html" %}
{% block content %}
<h1 class="h3 mb-3">Presales Questionnaire</h1>
<p class="help-text mb-4">Fill out all fields needed to generate the HLD/PDG inputs.</p>

<form method="POST" action="/presales/submit" id="presalesForm">
  <!-- Customer & Project -->
  <h2 class="h5 section-title">Customer & Project</h2>
  <div class="row g-3">
    <div class="col-md-6">
      <label class="form-label required">Customer Name</label>
      <input class="form-control" name="customer_name" placeholder="Acme Corp">
    </div>
    <div class="col-md-6">
      <label class="form-label required">Customer Slug (URL/filename safe)</label>
      <input class="form-control" name="customer_slug" placeholder="acme">
    </div>
  </div>
  <div class="row g-3 mt-1">
    <div class="col-md-12">
      <label class="form-label required">Project Name</label>
      <input class="form-control" name="project_name" placeholder="VDI Modernization">
    </div>
  </div>

  <!-- Contacts -->
  <h2 class="h5 section-title">Primary Contacts</h2>
  <div class="row g-3">
    <div class="col-md-6">
      <label class="form-label required">Primary Technical Contact (Name)</label>
      <input class="form-control" name="primary_contact_name" placeholder="Jane Smith">
    </div>
    <div class="col-md-6">
      <label class="form-label required">Primary Technical Contact (Email)</label>
      <input class="form-control" name="primary_contact_email" placeholder="jane.smith@example.com">
    </div>
  </div>
  <div class="mb-3 mt-3">
    <label class="form-label">Secondary / Operations Contacts</label>
    <input class="form-control" name="secondary_contacts" placeholder="ops@example.com; oncall@example.com">
  </div>

  <!-- Voice of Customer -->
  <h2 class="h5 section-title">Voice of the Customer</h2>
  <div class="mb-3">
    <label class="form-label required">Objectives / Outcomes</label>
    <textarea class="form-control" name="voc" rows="5" placeholder="Key drivers, success criteria, constraints."></textarea>
  </div>

  <!-- Scope -->
  <h2 class="h5 section-title">Scope</h2>
  <div class="row g-3">
    <div class="col-md-4">
      <label class="form-label required">Deployment Scope</label>
      <select class="form-select" name="pod_scope" id="pod_scope">
        <option value="single">Single pod</option>
        <option value="multi">Multi-pod</option>
      </select>
    </div>
    <div class="col-md-4">
      <label class="form-label required">Include Test/Dev Environments?</label>
      <select class="form-select" name="include_test_dev" id="include_test_dev">
        <option value="no">No</option>
        <option value="yes">Yes</option>
      </select>
    </div>
    <div class="col-md-4">
      <label class="form-label">Estimated Concurrent Users</label>
      <input class="form-control" name="concurrent_users" placeholder="e.g., 1200">
    </div>
  </div>
  <div class="mb-3 mt-3" id="test_dev_notes_group" style="display:none;">
    <label class="form-label">Test/Dev Notes</label>
    <textarea class="form-control" name="test_dev_notes" rows="3" placeholder="Environments, purpose, sizing, lifecycle expectations."></textarea>
  </div>

  <!-- Hosts / Sizing -->
  <h2 class="h5 section-title">Host / Cluster Sizing</h2>
  <div class="row g-3">
    <div class="col-md-3">
      <label class="form-label required">ESXi Hosts (per pod)</label>
      <input class="form-control" name="host_count" placeholder="e.g., 8">
    </div>
    <div class="col-md-3">
      <label class="form-label required">CPU per Host</label>
      <input class="form-control" name="cpu_per_host" placeholder="e.g., 2Ã— 32-core">
    </div>
    <div class="col-md-3">
      <label class="form-label required">RAM per Host</label>
      <input class="form-control" name="ram_per_host" placeholder="e.g., 512 GB">
    </div>
    <div class="col-md-3">
      <label class="form-label">Other Host Details</label>
      <input class="form-control" name="other_host_config" placeholder="NICs, GPU, firmware, etc.">
    </div>
  </div>

  <!-- Storage -->
  <h2 class="h5 section-title">Storage</h2>
  <div class="row g-3">
    <div class="col-md-4">
      <label class="form-label required">Primary Storage Type</label>
      <select class="form-select" name="storage_type" id="storage_type">
        <option value="vSAN">vSAN</option>
        <option value="Pure Storage">Pure Storage</option>
        <option value="PowerScale">PowerScale</option>
        <option value="Other">Other</option>
      </select>
    </div>
    <div class="col-md-4 storage-extra">
      <label class="form-label">Storage Vendor</label>
      <input class="form-control" name="storage_vendor" placeholder="e.g., Pure Storage">
    </div>
    <div class="col-md-4 storage-extra">
      <label class="form-label">Storage Model</label>
      <input class="form-control" name="storage_model" placeholder="e.g., //X50R2">
    </div>
    <div class="col-md-4 storage-extra">
      <label class="form-label">Usable Capacity (TB)</label>
      <input class="form-control" name="storage_capacity_tb" placeholder="e.g., 150">
    </div>
  </div>

  <!-- Networking / LB -->
  <h2 class="h5 section-title">Networking & Load Balancing</h2>
  <div class="row g-3">
    <div class="col-md-4">
      <label class="form-label required">Load Balancer</label>
      <select class="form-select" name="load_balancer">
        <option value="F5 BIG-IP">F5 BIG-IP</option>
        <option value="Avi / NSX ALB">Avi / NSX ALB</option>
        <option value="Netscaler (Citrix ADC)">Netscaler (Citrix ADC)</option>
        <option value="Other / TBD">Other / TBD</option>
        <option value="None">None</option>
      </select>
    </div>
    <div class="col-md-4">
      <label class="form-label">Management Network CIDR</label>
      <input class="form-control" name="mgmt_cidr" placeholder="e.g., 10.0.0.0/24">
    </div>
    <div class="col-md-4">
      <label class="form-label">VM / Desktop Networks</label>
      <input class="form-control" name="vm_networks" placeholder="list or ranges">
    </div>
  </div>

  <!-- Access & Identity -->
  <h2 class="h5 section-title">Access & Identity</h2>
  <div class="row g-3">
    <div class="col-md-4">
      <label class="form-label required">Integrate with 3rd-party IdP?</label>
      <select class="form-select" name="idp_integrate" id="idp_integrate">
        <option value="no">No</option>
        <option value="yes">Yes</option>
      </select>
    </div>
    <div class="col-md-8" id="idp_provider_group" style="display:none;">
      <label class="form-label">IdP Provider</label>
      <input class="form-control" name="idp_provider" placeholder="Okta, Entra ID, Ping, ADFS">
    </div>
  </div>

  <!-- Notes -->
  <h2 class="h5 section-title">Additional Notes</h2>
  <div class="mb-3">
    <label class="form-label">Notes / Assumptions / Risks</label>
    <textarea class="form-control" name="notes" rows="4" placeholder="Anything else we should know?"></textarea>
  </div>

  <div class="d-flex gap-2">
    <button class="btn btn-primary" type="submit">Review Submission</button>
    <a class="btn btn-outline-secondary" href="/">Reset</a>
  </div>
</form>

<script>
  function toggleTestDev() {
    const sel = document.getElementById('include_test_dev');
    const grp = document.getElementById('test_dev_notes_group');
    grp.style.display = sel.value === 'yes' ? 'block' : 'none';
  }
  function toggleStorage() {
    const sel = document.getElementById('storage_type');
    const extras = document.querySelectorAll('.storage-extra');
    const showExtras = sel.value !== 'vSAN';
    extras.forEach(el => el.style.display = showExtras ? 'block' : 'none');
  }
  function toggleIdP() {
    const sel = document.getElementById('idp_integrate');
    const grp = document.getElementById('idp_provider_group');
    grp.style.display = sel.value === 'yes' ? 'block' : 'none';
  }
  document.getElementById('include_test_dev')?.addEventListener('change', toggleTestDev);
  document.getElementById('storage_type')?.addEventListener('change', toggleStorage);
  document.getElementById('idp_integrate')?.addEventListener('change', toggleIdP);
  toggleTestDev(); toggleStorage(); toggleIdP();
</script>
{% endblock %}
