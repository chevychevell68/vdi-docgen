{% extends "base.html" %}
{% block title %}Submission History{% endblock %}
{% block content %}
<h1 class="h3 mb-3">Presales Submissions</h1>

{% if not rows %}
  <div class="alert alert-info">No submissions yet. Fill out the <a href="{{ url_for('presales') }}">Presales form</a>.</div>
{% else %}
  <div class="table-responsive">
    <table class="table table-sm align-middle">
      <thead class="table-light">
        <tr>
          <th>Submitted</th>
          <th>Company</th>
          <th>Salesforce Opportunity</th>
          <th class="text-nowrap">Actions</th>
        </tr>
      </thead>
      <tbody>
      {% for r in rows %}
        <tr>
          <td class="text-nowrap">{{ r.submitted_at or r["submitted_at"] }}</td>
          <td class="text-nowrap"><a href="{{ url_for('presales_view', submit_id=r.id or r['id']) }}">{{ r.company_name or r['company_name'] }}</a></td>
          <td>
            {% set url = r.sf_url or r["sf_url"] %}
            {% set name = r.sf_op_name or r["sf_op_name"] %}
            {% if url %}
              <a href="{{ url }}" target="_blank" rel="noopener">{{ name }}</a>
            {% else %}
              {{ name }}
            {% endif %}
          </td>
          <td class="text-nowrap">
            <a class="btn btn-sm btn-primary" href="{{ url_for('presales_view', submit_id=r.id or r['id']) }}">View / Print</a>
            <a class="btn btn-sm btn-outline-secondary" href="{{ url_for('presales_edit', submit_id=r.id or r['id']) }}">Edit</a>
          </td>
        </tr>
      {% endfor %}
      </tbody>
    </table>
  </div>
{% endif %}
{% endblock %}
